C51 COMPILER V9.54   IR                                                                    11/30/2024 14:31:36 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN .\Objects\IR.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE IR.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\IR.lst) 
                    -OBJECT(.\Objects\IR.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Timer0.h"
   3          #include "Int0.h"
   4          
   5          /* 
   6                  Ëß£Á†ÅÔºö
   7                          0Áä∂ÊÄÅÔºöË°®Á§∫Á©∫Èó≤Áä∂ÊÄÅ
   8                          1Áä∂ÊÄÅÔºöÂΩì0Áä∂ÊÄÅÊù•‰∏™„Äê‰∏ãÈôçÊ≤ø„ÄëÊó∂->1Áä∂ÊÄÅÔºåÂØªÊâæÈáçÂ§çrepeatÂíåstartÁä∂ÊÄÅÔºåËØª
   9                                     Âá∫‰ªé0Áä∂ÊÄÅÂà∞1Áä∂ÊÄÅÁöÑÊó∂Èó¥Ôºå„ÄêÂ¶ÇÊûú1Áä∂ÊÄÅÂà§Êñ≠‰∏∫ repeatÈáçÂèë Ôºå
  10                                     Â∞ÜÈáçÂèëÊ†áÂøó‰ΩçÁΩÆ‰∏ÄÔºåÂπ∂Â∞ÜÁä∂ÊÄÅÂàáÊç¢‰∏∫0Áä∂ÊÄÅ„Äë
  11                          2Áä∂ÊÄÅÔºöÂ¶ÇÊûú1Áä∂ÊÄÅÂà§Êñ≠‰∏∫ startÔºåÂàôËΩ¨‰∏∫2Áä∂ÊÄÅÔºåÂç≥ÂºÄÂßãËß£Á†Å„Äê101010....ÁöÑ
  12                                     32‰ΩçÁöÑbitÊï∞ÊçÆ„ÄëÂú®È™åËØÅÊï∞ÊçÆÊé•Êî∂Ê≠£Á°ÆÂêéÔºå„ÄêIR_RepeatFlag‰∏∫1„ÄëÂ∞Ü
  13                                     Áä∂ÊÄÅÂàáÊç¢‰∏∫0Áä∂ÊÄÅ„ÄÇ
  14          */
  15          unsigned int IR_Time;         // ËÆ°Êó∂
  16          unsigned char IR_State;       // ÂÆö‰πâÁä∂ÊÄÅ„Äê0Ôºå1Ôºå2„Äë
  17          
  18          unsigned char IR_Data[4];     // Áî®4‰∏™ÂÖÉÁ¥†ÁöÑÊï∞ÁªÑÊù•Â≠òÂÇ®32‰ΩçÊï∞ÊçÆÔºåÁî®„ÄêlongÂûã„Äë‰ºöÂá∫Èîô
  19          unsigned char IR_pData;       // ÊåáÂêëÂΩìÂâçÁöÑÂì™‰∏™‰ΩçÁΩÆ„ÄêÊî∂Âà∞Á¨¨Âá†‰Ωç‰∫Ü„ÄëÂ¶ÇÊûúÊî∂Âà∞32‰ΩçÂ∞±ËØ
             -ÅÊòéÁªìÊùü‰∫Ü
  20          
  21          unsigned char IR_DataFlag;    // Âú®È™åËØÅÊï∞ÊçÆÊé•Êî∂Ê≠£Á°ÆÂêéÔºåËÆ∞ÂΩïÊï∞ÊçÆÊòØÂê¶Êé•Êî∂Ê†áÂøó‰Ωç
  22          unsigned char IR_RepeatFlag;  // ÈáçÂèëÊ†áÂøó‰Ωç„ÄêÂΩì‰∏ÄÁõ¥Âú®ÊåâÊåâÈîÆÊó∂ÁΩÆ1„Äë
  23          unsigned char IR_Address;     // Âú∞ÂùÄÁ†ÅÔºåÈò≤Ê≠¢Êï∞ÊçÆÊîæÂú®IR_Data[4]ÈáåÔºåËæπÊî∂Êï∞ÊçÆËæπÂèëÊï∞ÊçÆ
  24          unsigned char IR_Command;     // ÂëΩ‰ª§Á†ÅÔºåÂêå‰∏ä
  25          
  26          /**
  27            * @brief   Á∫¢Â§ñÂàùÂßãÂåñ
  28            * @param   Êó†
  29            * @retval  Êó†
  30            */
  31          void IR_Init(void)
  32          {
  33   1              Timer0Init();
  34   1              Int0_Init();
  35   1      }
  36          
  37          //--------------------------------------------------------------------------
  38          //--------------------------------------------------------------------------
  39          //--------------------------------------------------------------------------
  40          // ÈõÜÊàêÂà∞ÂáΩÊï∞Èáå
  41          
  42          /**
  43            * @brief   Ëé∑Âèñ DataFlag Ê†áÂøó‰Ωç
  44            * @param   Êó†
  45            * @retval  1ÔºöÊî∂Âà∞Êï∞ÊçÆ   0ÔºöÊ≤°Êî∂Âà∞Êï∞ÊçÆ
  46            */
  47          unsigned char IR_GetDataFlag(void)
  48          {
  49   1              if(IR_DataFlag)      // Â¶ÇÊûúIR_DataFlag‰∏∫1ÔºåÂàôÊ∏ÖÈõ∂ÔºåËøîÂõû1
  50   1              {
  51   2                      IR_DataFlag = 0;
  52   2                      return 1;
  53   2              }
C51 COMPILER V9.54   IR                                                                    11/30/2024 14:31:36 PAGE 2   

  54   1              return 0;            // Â¶ÇÊûúIR_DataFlag‰∏∫0ÔºåËøîÂõû0
  55   1      }
  56          
  57          /**
  58            * @brief    Ëé∑ÂèñÈáçÂèëÊ†áÂøó‰Ωç
  59            * @param    Êó†
  60            * @retval   1ÔºöÈáçÂèë  0ÔºöÊ≤°ÈáçÂèë
  61            */
  62          unsigned char IR_GetRepeatFlag(void)
  63          {
  64   1              if(IR_RepeatFlag)      // Â¶ÇÊûúIR_DataFlag‰∏∫1ÔºåÂàôÊ∏ÖÈõ∂ÔºåËøîÂõû1
  65   1              {
  66   2                      IR_RepeatFlag = 0;
  67   2                      return 1;
  68   2              }
  69   1              return 0; 
  70   1      }
  71          
  72          /**
  73            * @brief    Ëé∑ÂèñÂú∞ÂùÄÁ†Å
  74            * @param    Êó†
  75            * @retval   IR_AddressÔºöÂú∞ÂùÄÁ†Å
  76            */
  77          unsigned char IR_GetAddress(void)
  78          {
  79   1              return IR_Address;
  80   1      }
  81          
  82          /**
  83            * @brief    Ëé∑ÂèñÂëΩ‰ª§Á†Å
  84            * @param    Êó†
  85            * @retval   IR_CommandÔºöÂëΩ‰ª§Á†Å
  86            */
  87          unsigned char IR_GetCommand(void)
  88          {
  89   1              return IR_Command;
  90   1      }
  91          
  92          
  93          //--------------------------------------------------------------------------
  94          //--------------------------------------------------------------------------
  95          //--------------------------------------------------------------------------
  96          
  97          
  98          /**
  99            * @brief    Ëß£Á†Å
 100            * @param    Êó†
 101            * @retval   Êó†
 102            */
 103          void Int0_Routine(void) interrupt 0  // Êî∂Âà∞„Äê‰∏ãÈôçÊ≤ø„ÄëËøõÂÖ•‰∏≠Êñ≠ÔºåÁúã„ÄêInt0.c„Äë
 104          {
 105   1              if(IR_State == 0)    // 0Áä∂ÊÄÅÊî∂Âà∞„Äê‰∏ãÈôçÊ≤ø„Äë
 106   1              {
 107   2                      Timer_SetCounter(0);
 108   2                      TIMER_Run(1);
 109   2                      IR_State = 1;
 110   2              }
 111   1              else if(IR_State == 1)    // „ÄêËµ∑Âßã‰ø°Âè∑„Äë
 112   1              {
 113   2                      IR_Time = Timer_GetCounter();   // ËØªÂà∞„ÄêÈó¥ÈöîÊó∂Èó¥„ÄëÔºåÁî®Êù•Âà§Êñ≠ÊòØ„Äêstart„Äë
 114   2                                                                                      // ËøòÊòØ„ÄêRepeat„Äë
 115   2                      Timer_SetCounter(0);   // ËÆ°Êï∞Âô®Ê∏ÖÈõ∂Ôºå‰∏∫‰∫Ü‰∏ã‰∏ÄÊ¨°ËÆ°Êó∂
C51 COMPILER V9.54   IR                                                                    11/30/2024 14:31:36 PAGE 3   

 116   2                      
 117   2                      if(IR_Time > 12442-500 && IR_Time < 12442+500)       //„Äêstart„Äë
 118   2                      // Ëµ∑Âßã(start) Êó∂Èó¥‰∏∫ 9000(‰ΩéÁîµÂπ≥)+4500(È´òÁîµÂπ≥) = 13500 „Äê12MHZ„Äë
 119   2                      // ‰ΩÜÊòØÂØπ‰∫é Êú¨51ÂçïÁâáÊú∫ Áî®ÁöÑÊòØ„Äê11.0592MHz„Äë ÔºåÁªìÊûú‰∏∫„Äê13500/1.085 = 12442„Äë
 120   2                      // Êúâ‰∫õ„ÄêËØØÂ∑Æ„ÄëÔºåÂ∞±‰∏ä‰∏ã500ÁöÑËåÉÂõ¥„ÄÇ
 121   2                      {
 122   3                              IR_State = 2;
 123   3                      }
 124   2                      else if(IR_Time > 10368-500 && IR_Time < 10368+500)  //„ÄêRepeat„Äë 
 125   2                      // 9000 + 2250 = „Äê11250„Äë
 126   2                      // ÂØπ‰∫é Êú¨51ÂçïÁâáÊú∫ Ôºå ÁªìÊûú‰∏∫„Äê11250/1.085 = 10368„Äë
 127   2                      {
 128   3                              IR_RepeatFlag = 1;    // Êåâ‰∏ãÊåâÈîÆÊó∂Èó¥ÈïøÔºåÂ∑≤ÁªèÂèëÈÄÅÊåâÈîÆÂëΩ‰ª§‰∫ÜÔºåËøòÂú®
 129   3                                                                        //ÊåâÔºå„ÄêËØ¥ÊòéËøô‰∏ÄÂ∏ß Â∑≤Áªè ÁªìÊùü‰∫Ü„Äë„ÄêÂ∑≤ÁªèÊî∂Âà∞‰∫Ü„Äë
 130   3                              TIMER_Run(0);         // ÂÅúÊ≠¢ËÆ°Êó∂Âô®
 131   3                              IR_State = 0;         // Áä∂ÊÄÅÁΩÆ‰∏∫0Áä∂ÊÄÅ
 132   3                      }
 133   2                      else       // ÂÖ∂‰ªñÊÉÖÂÜµÔºåËß£Á†ÅÈîôËØØ
 134   2                      {
 135   3                              IR_State = 1;    //ËΩ¨Âà∞ „ÄêÊú¨Áä∂ÊÄÅ„Äë„ÄêËµ∑ÂßãÁä∂ÊÄÅ„Äë
 136   3                      }
 137   2              }
 138   1              else if(IR_State == 2)      
 139   1                      //Êé•Êî∂„ÄêÈÅ•ÊéßÂô®Á∫¢Â§ñÂú∞ÂùÄÔºåÂú∞ÂùÄÂèçÁ†ÅÔºåÈîÆÁ†ÅÔºåÈîÆÁ†ÅÂèçÁ†Å„Äë
 140   1              {
 141   2                      IR_Time = Timer_GetCounter();
 142   2                      Timer_SetCounter(0);   //‰∏∫‰∫Ü‰∏ã‰∏ÄÊ¨°ËÆ°Êó∂
 143   2                      if(IR_Time > 1032-500 && IR_Time < 1032+500)         // Â≠ò 0 ‰Ωç
 144   2                      {
 145   3                              IR_Data[IR_pData/8]&=~(0x01<<(IR_pData%8));      // ÂØπÂ∫î‰ΩçÁΩÆÈõ∂
 146   3                              /*
 147   3                                      ÂØπ‰∏Ä‰∏™Êï∞ÁªÑ IR_Data ‰∏≠ÁöÑÊüê‰∏™Â≠óËäÇÂÖÉÁ¥†ËøõË°åÊåâ‰ΩçÊìç‰ΩúÔºåÂÖ∑‰ΩìÊòØ
 148   3                                      Â∞ÜËØ•Â≠óËäÇ‰∏≠ÁöÑÊüê‰∏Ä‰ΩçÊ∏ÖÈõ∂Ôºå‰æãÂ¶ÇÔºåÂ¶ÇÊûú IR_pData ÊòØ 5ÔºåÈÇ£‰πà
 149   3                                      IR_pData%8 Á≠â‰∫é 5Ôºå0x01 << 5 ÁöÑÁªìÊûúÂ∞±ÊòØ‰∫åËøõÂà∂Êï∞ 00100000
 150   3                                      ÂèñÂèçÂêéÂ∞±ÊòØ 11011111ÔºåÁî±‰∫éÊé©Á†Å‰∏≠Ë¶ÅÊ∏ÖÈõ∂ÁöÑ‰Ωç‰∏∫ 0ÔºåÊâÄ‰ª•ÁªèËøáÊåâ
 151   3                                      ‰Ωç‰∏éÊìç‰ΩúÂêéÔºåIR_Data[IR_pData/8] ‰∏≠ÂØπÂ∫îÁöÑÈÇ£‰∏Ä‰ΩçÂ∞±‰ºöË¢´Ê∏ÖÈõ∂Ôºå
 152   3                                      ËÄåÂÖ∂‰ªñ‰Ωç‰øùÊåÅ‰∏çÂèò„ÄÇ
 153   3      -----------------------------------------------------------------------------
 154   3                                      ÂØπ‰∫éÊé©Á†Å‰∏≠‰∏∫ 1 ÁöÑÈÇ£‰∫õ‰ΩçÔºö‰∏çÁÆ° IR_Data[IR_pData/8] ‰∏≠ÂØπÂ∫î‰Ωç
 155   3                                      ÂéüÊú¨ÊòØ 0 ËøòÊòØ 1ÔºåÊåâ‰Ωç‰∏éÁöÑÁªìÊûúÂ∞±ÊòØ IR_Data[IR_pData/8] ‰∏≠ÂØπ
 156   3                                      Â∫î‰ΩçÊú¨Ë∫´ÁöÑÂÄºÔºåÊâÄ‰ª•Ëøô‰∫õ‰Ωç‰ºö‰øùÊåÅ‰∏çÂèò„ÄÇ
 157   3                              
 158   3                                      ÂØπ‰∫éÊé©Á†Å‰∏≠‰∏∫ 0 ÁöÑÈÇ£‰∏Ä‰ΩçÔºà‰πüÂ∞±ÊòØË¶ÅÊ∏ÖÈõ∂ÁöÑ‰ΩçÔºâÔºöÊó†ËÆ∫ IR_Data
 159   3                                      [IR_pData/8] ‰∏≠ÂØπÂ∫î‰ΩçÂéüÊú¨ÊòØ‰ªÄ‰πàÂÄºÔºåÊåâ‰Ωç‰∏éÁöÑÁªìÊûúÈÉΩ‰ºö‰ΩøËØ•‰Ωç
 160   3                                      Âèò‰∏∫ 0Ôºå‰ªéËÄåÂÆûÁé∞‰∫ÜÂ∞ÜÁâπÂÆöÁöÑ‰∏Ä‰ΩçÊ∏ÖÈõ∂ÁöÑÁõÆÁöÑ„ÄÇ
 161   3                              */
 162   3                              IR_pData++;
 163   3                      }
 164   2                      else if(IR_Time > 2073-500 && IR_Time < 2073+500)    // Â≠ò 1 ‰Ωç
 165   2                      {
 166   3                              IR_Data[IR_pData/8]|=(0x01<<(IR_pData%8));       // ÂØπÂ∫î‰ΩçÁΩÆ‰∏Ä
 167   3                              IR_pData++;
 168   3                      }
 169   2                      else                 // Âá∫Èîô
 170   2                      {
 171   3                              IR_pData = 0;    // Ê∏ÖÈõ∂
 172   3                              IR_State = 1;    // Âèò‰∏∫ÂàùÂßãÁä∂ÊÄÅ
 173   3                      }
 174   2                      if(IR_pData >= 32)   //Êî∂ÂÆå32‰ΩçÊï∞ÊçÆ
 175   2                      {
 176   3                              IR_pData = 0;    // Ê∏ÖÈõ∂
 177   3                              if((IR_Data[0] == ~IR_Data[1]) && (IR_Data[2] == ~IR_Data[3]))
C51 COMPILER V9.54   IR                                                                    11/30/2024 14:31:36 PAGE 4   

 178   3                              // È™åËØÅÊé•Êî∂Êï∞ÊçÆÊ≠£Á°Æ
 179   3                              {
 180   4                                      IR_Address = IR_Data[0];
 181   4                                      IR_Command = IR_Data[2];
 182   4                                      IR_DataFlag = 1;   // ‰ª£Ë°®Êï∞ÊçÆÂ∑≤ÁªèËøáÊù•‰∫Ü
 183   4                              }
 184   3                              TIMER_Run(0);  // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
 185   3                              IR_State = 0;  // ÂàáÊç¢‰∏∫„ÄêÁ©∫Èó≤Áä∂ÊÄÅ„Äë
 186   3                      }
 187   2              }
 188   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    370    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
