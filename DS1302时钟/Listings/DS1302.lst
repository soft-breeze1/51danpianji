C51 COMPILER V9.54   DS1302                                                                11/05/2024 20:17:29 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\DS1302.obj
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.EXE DS1302.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\DS13
                    -02.lst) OBJECT(.\Objects\DS1302.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Delay.h"
   3          
   4          sbit DS1302_SCLK = P3^6;
   5          sbit DS1302_IO = P3^4;
   6          sbit DS1302_CE = P3^5;
   7          
   8          #define DS1302_SECOND           0X80
   9          #define DS1302_MINUTE           0X82
  10          #define DS1302_HOUR                     0X84
  11          #define DS1302_DATE                     0X86
  12          #define DS1302_MONTH            0X88
  13          #define DS1302_DAY                      0X8A
  14          #define DS1302_YEAR                     0X8C
  15          #define DS1302_WP                       0X8E
  16          
  17          unsigned char DS1302_Time[] = {24,11,5,12,59,55,2};
  18          
  19          /**
  20            * @brief    DS1302åˆå§‹åŒ–ï¼ˆä¸¤ä¸ªå¼•è„šç”µå¹³ç½®ä¸º0ï¼‰
  21            * @param    æ— 
  22            * @retval   æ— 
  23            */
  24          void DS1302_Init(void)
  25          {
  26   1              DS1302_CE = 0;           //åˆšå¼€å§‹ä¸Šç”µæ—¶CEå’ŒSCLKé»˜è®¤éƒ½æ˜¯1ï¼Œè¦å…ˆç½®ä¸º0
  27   1              DS1302_SCLK = 0;
  28   1      }
  29          
  30          /**
  31            * @brief     å‘DS1302ä¸­å†™å…¥1ä¸ªæ•°æ®
  32            * @param     Commandï¼šå†™å…¥å‘½ä»¤
  33            * @param     Dataï¼šè¦å†™å…¥çš„æ•°æ®
  34            * @retval    æ— 
  35            */
  36          void DS1302_WriteByte(unsigned char Command,Data)  //16ä¸ªä¸Šå‡ä¸‹é™æ²¿
  37          {
  38   1              unsigned char i;
  39   1              DS1302_CE = 1;
  40   1              
  41   1              for(i=0;i<8;i++)
  42   1              {
  43   2                      DS1302_IO = Command&(0x01<<i);    //å–Commandçš„ç¬¬(0x01<<i)ä½
  44   2                      DS1302_SCLK = 1;      //å¦‚æœç½®ä¸€å’Œç½®é›¶çš„é—´éš”å°äºä½¿ç”¨æ‰‹å†Œä¸Šçš„æ—¶é—´ï¼Œå°±è¦åŠ ä¸Šå»¶æ—
             -¶å‡½æ•°
  45   2                      DS1302_SCLK = 0;
  46   2              }
  47   1              for(i=0;i<8;i++)
  48   1              {
  49   2                      DS1302_IO = Data&(0x01<<i);    //å–Commandçš„ç¬¬(0x01<<i)ä½
  50   2                      DS1302_SCLK = 1;      //å¦‚æœç½®ä¸€å’Œç½®é›¶çš„é—´éš”å°äºä½¿ç”¨æ‰‹å†Œä¸Šçš„æ—¶é—´ï¼Œå°±è¦åŠ ä¸Šå»¶æ—
             -¶å‡½æ•°
  51   2                      DS1302_SCLK = 0;
  52   2              }
C51 COMPILER V9.54   DS1302                                                                11/05/2024 20:17:29 PAGE 2   

  53   1              DS1302_CE = 0;    //æœ€åå°†CEç½®ä¸º0ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å†™å…¥æ•°æ®
  54   1      }
  55          
  56          /**
  57            * @brief   å°†DS1302ä¸­çš„ä¸€ä¸ªæ•°æ®è¯»å‡º   
  58            * @param   Commandï¼šè¯»å‡ºå‘½ä»¤
  59            * @retval  Dataï¼šè¯»å‡ºçš„æ•°æ®
  60            */
  61          unsigned char DS1302_ReadByte(unsigned char Command) //15ä¸ªä¸Šå‡ä¸‹é™æ²¿
  62          {
  63   1              unsigned char i,Data = 0x00;   //å…¨å±€å˜é‡ä¸ç”¨åˆå§‹åŒ–ï¼ˆé»˜è®¤åœ°å€ä½0x00ï¼‰ï¼Œå®šä¹‰ä¸ºå±€éƒ¨å
             -˜é‡éœ€è¦åˆå§‹åŒ–åœ°å€
  64   1              Command |= 0x01;        //ã€ã€å…ˆå°†Commandæˆ–1ï¼Œä¹Ÿå°±æ˜¯åŠ 1ï¼Œä¸ºè¯»å‘½ä»¤ã€‘ã€‘
  65   1              //ã€è¿™æ ·å°±å¯ä»¥ç”¨ä¸€ä¸ªå®æ¥æ“ä½œä¸¤ä¸ªå‡½æ•°ã€‘
  66   1              DS1302_CE = 1;
  67   1              for(i=0;i<8;i++)
  68   1              {
  69   2                      DS1302_IO = Command&(0x01<<i);    //å–Commandçš„ç¬¬(0x01<<i)ä½
  70   2                      DS1302_SCLK = 0;   //å…ˆå°†SCLKç½®é›¶ï¼Œå†å°†å…¶ç½®ä¸€ï¼Œæ˜¯å› ä¸ºé˜²æ­¢æœ€åä¸€æ¬¡å°†SCLKç½®é›¶æ—¶
  71   2                      DS1302_SCLK = 1;   //å°†åç»­çš„æ•°æ®è¯»å‡ºæ¥ï¼Œæ•…æ”¹å˜SCLKçš„é¡ºåº
  72   2              }
  73   1              for(i=0;i<8;i++)
  74   1              {
  75   2                      DS1302_SCLK = 1;      //åœ¨å‰é¢SCLKå·²ç»ç½®ä¸€çš„æƒ…å†µä¸‹å†æ¬¡ç½®ä¸€æ²¡æœ‰å½±å“
  76   2                      DS1302_SCLK = 0;      //å°†ç¬¬ä¸€ä½è¯»å‡ºåˆ°IOè¾“å‡ºçº¿ä¸Š
  77   2                      if(DS1302_IO)   //å¦‚æœDS1302_IO = 1ï¼Œå³è¯»å‡ºæ•°æ®
  78   2                              //å¦‚æœè¾“å‡ºä¸º1å°±è®°å½•ï¼Œå¦‚æœè¾“å‡ºä¸º0å°±ä¸å˜ï¼Œi+1ç»§ç»­å¾ªç¯
  79   2                          //ã€ã€å› ä¸ºDataå¼€å§‹æ—¶å°±å…¨ä¸º0ï¼Œåªæœ‰æ˜¯1æ—¶æ‰éœ€è¦åŒæ­¥ã€‘ã€‘
  80   2                      {
  81   3                              Data = Data|(0x01<<i);   
  82   3                              //å¦‚æœè¯»å–åˆ°æ•°æ®ä½ä¸º 1ï¼Œåˆ™å°†Dataçš„ç¬¬iä½ç½®ä¸º 1ï¼Œå³å°†è¯»å–åˆ°çš„æ•°æ®ä½å­˜å‚¨åˆ°Da
             -taå˜é‡ä¸­ã€‚
  83   3                      }
  84   2              }
  85   1              DS1302_CE = 0;
  86   1              DS1302_IO = 0;     //å°†DS1302_IOç½®ä¸º0ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è¯»æ•°æ®æˆ–è€…å†™å…¥æ•°æ®
  87   1              return Data;
  88   1      }
  89          
  90          /**
  91            * @brief    å°†å†™å…¥DS1302æ—¶é’Ÿæ¨¡å—æ•°æ®è¿™ä¸€æ­¥éª¤æ¨¡å—åŒ–ï¼Œç›´æ¥è°ƒç”¨å¯ä»¥è¿ç»­å†™å…¥å¤šä¸
             -ªæ•°æ®
  92            * @param    æ— 
  93            * @retval   æ— 
  94            */
  95          void DS1302_SetTime(void)    //ã€æ¨¡å—åŒ–åå°±åªç”¨è°ƒå–DS1302_SetTimeå’ŒDS1302_ReadTimeã€‘
  96          {
  97   1              DS1302_WriteByte(DS1302_WP,0x00); //å…³é—­èŠ¯ç‰‡å†™ä¿æŠ¤
  98   1              DS1302_WriteByte(DS1302_YEAR,DS1302_Time[0]/10*16+DS1302_Time[0]%10);  //è½¬ä¸ºBCDç 
  99   1              DS1302_WriteByte(DS1302_MONTH,DS1302_Time[1]/10*16+DS1302_Time[1]%10);
 100   1              DS1302_WriteByte(DS1302_DATE,DS1302_Time[2]/10*16+DS1302_Time[2]%10);
 101   1              DS1302_WriteByte(DS1302_HOUR,DS1302_Time[3]/10*16+DS1302_Time[3]%10);
 102   1              DS1302_WriteByte(DS1302_MINUTE,DS1302_Time[4]/10*16+DS1302_Time[4]%10);
 103   1              DS1302_WriteByte(DS1302_SECOND,DS1302_Time[5]/10*16+DS1302_Time[5]%10);
 104   1              DS1302_WriteByte(DS1302_DAY,DS1302_Time[6]/10*16+DS1302_Time[6]%10);
 105   1              DS1302_WriteByte(DS1302_WP,0x00); //å…³é—­èŠ¯ç‰‡å†™ä¿æŠ¤
 106   1              
 107   1      }
 108          
 109          /**
 110            * @brief    å°†è¯»å‡ºDS1302æ—¶é’Ÿæ¨¡å—è¿™ä¸€æ­¥éª¤æ¨¡å—åŒ–ï¼Œå¯ä»¥è¿ç»­è¯»å‡ºå¤šä¸ªæ•°æ®
 111            * @param    æ— 
C51 COMPILER V9.54   DS1302                                                                11/05/2024 20:17:29 PAGE 3   

 112            * @retval   æ—  
 113            */
 114          void DS1302_ReadTime(void)
 115          {
 116   1              unsigned char Temp;   //æš‚æ—¶å­˜å‚¨ä¸€ä¸ªä»DS1320æ—¶é’Ÿæ¨¡å—è¯»å‡ºçš„æ•°æ®
 117   1              Temp = DS1302_ReadByte(DS1302_YEAR);
 118   1              DS1302_Time[0] = Temp/16*10 + Temp%16;    //è½¬ä¸ºåè¿›åˆ¶
 119   1              Temp = DS1302_ReadByte(DS1302_MONTH);
 120   1              DS1302_Time[1] = Temp/16*10 + Temp%16;
 121   1              Temp = DS1302_ReadByte(DS1302_DATE);
 122   1              DS1302_Time[2] = Temp/16*10 + Temp%16;
 123   1              Temp = DS1302_ReadByte(DS1302_HOUR);
 124   1              DS1302_Time[3] = Temp/16*10 + Temp%16;
 125   1              Temp = DS1302_ReadByte(DS1302_MINUTE);
 126   1              DS1302_Time[4] = Temp/16*10 + Temp%16;
 127   1              Temp = DS1302_ReadByte(DS1302_SECOND);
 128   1              DS1302_Time[5] = Temp/16*10 + Temp%16;
 129   1              Temp = DS1302_ReadByte(DS1302_DAY);
 130   1              DS1302_Time[6] = Temp/16*10 + Temp%16;
 131   1              
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    550    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
